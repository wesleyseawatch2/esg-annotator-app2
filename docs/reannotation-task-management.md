# 重標註任務管理指南

## 📋 功能概述

管理員可以透過**任務管理頁面**彈性控制重標註任務，包括：

- ✅ 查看所有重標註任務
- ✅ 篩選任務（按狀態、使用者、專案）
- ✅ 批次刪除任務
- ✅ 搜尋特定任務
- ✅ 統計任務進度

---

## 🚀 快速開始

### 進入任務管理頁面

1. 登入管理員帳號
2. 前往 `/admin/reannotation`
3. 點擊「📋 管理現有任務」按鈕
4. 或直接前往 `/admin/reannotation/manage`

---

## 📊 頁面功能說明

### 1. 統計摘要

頁面上方顯示任務統計：
- **總任務數** - 所有重標註任務總計
- **待處理** - 尚未開始的任務
- **進行中** - 標註者已打開但尚未送出
- **已送出** - 標註者已完成
- **已跳過** - 標註者選擇跳過的任務

### 2. 篩選功能

**搜尋框**：
- 搜尋文本內容
- 搜尋使用者名稱
- 搜尋資料 ID

**狀態篩選**：
- 所有狀態
- 待處理
- 進行中
- 已送出
- 已跳過

**使用者篩選**：
- 所有使用者
- 特定使用者（下拉選單）

### 3. 任務列表

顯示欄位：
- **任務 ID** - 任務的唯一識別碼
- **資料 ID** - 對應的 source_data_id
- **使用者** - 被分配的標註者
- **專案** - 所屬專案名稱
- **輪次** - Round 編號
- **任務組** - G1 (承諾+時間) 或 G2 (證據)
- **文本** - 永續承諾文本摘要
- **狀態** - 當前狀態徽章
- **分配時間** - 任務建立時間
- **送出時間** - 完成時間（如已完成）

### 4. 批次操作

**全選/取消全選**：
- 點擊表頭的勾選框

**刪除選中任務**：
1. 勾選要刪除的任務
2. 點擊「🗑️ 刪除選中 (X)」按鈕
3. 確認刪除
4. ⚠️ **此操作無法復原！**

**重新整理**：
- 點擊「🔄 重新整理」按鈕載入最新資料

---

## 🎯 常見使用情境

### 情境 1: 刪除誤建的任務

**問題**：不小心建立了錯誤的輪次，想刪除所有任務

**步驟**：
1. 進入任務管理頁面
2. 使用篩選器選擇特定輪次（例如 Round 1）
3. 點擊表頭勾選框全選
4. 點擊「刪除選中」
5. 確認刪除

### 情境 2: 只想讓特定使用者重標註

**問題**：建立輪次時自動分配給所有人，但只想讓 A 和 B 重標

**步驟**：
1. 進入任務管理頁面
2. 篩選「使用者」選擇 C（不需要的使用者）
3. 全選 C 的任務
4. 刪除選中的任務
5. 重複步驟 2-4 刪除其他不需要的使用者

### 情境 3: 移除已完成的任務

**問題**：某些任務已經送出並確認無誤，想清理任務列表

**步驟**：
1. 篩選「狀態」選擇「已送出」
2. 勾選已確認無誤的任務
3. 刪除選中的任務

### 情境 4: 搜尋特定資料的任務

**問題**：想查看資料 ID #123 的所有重標註任務

**步驟**：
1. 在搜尋框輸入「123」
2. 查看篩選後的結果
3. 可查看哪些使用者被分配、狀態如何

---

## ⚠️ 注意事項

### 刪除任務的影響

**會刪除**：
- ✅ `reannotation_tasks` 表的任務記錄

**不會刪除**：
- ❌ 標註者已修改的答案（`annotations` 表）
- ❌ 審計日誌（`reannotation_audit_log` 表）
- ❌ 輪次記錄（`reannotation_rounds` 表）

### 最佳實踐

1. **建立輪次前先規劃好**
   - 確定要分配給哪些使用者
   - 確定一致性門檻合理
   - 確定任務組別正確

2. **刪除前先確認**
   - 檢查任務狀態（避免刪除進行中的任務）
   - 使用篩選器精確選擇要刪除的任務
   - 刪除前再次確認數量和使用者

3. **定期清理已完成任務**
   - 減少列表混亂
   - 保持頁面整潔
   - 提升載入速度

4. **保留審計日誌**
   - 刪除任務不會刪除審計日誌
   - 可追溯歷史變更
   - 支援後續分析

---

## 🔧 API 說明

### GET /api/reannotation/manage-tasks

**功能**：查詢所有重標註任務

**參數**：
- `userId` (必填) - 管理員 ID
- `projectId` (選填) - 專案 ID
- `roundId` (選填) - 輪次 ID

**回傳**：
```json
{
  "success": true,
  "data": {
    "tasks": [...],
    "stats": {
      "total": 100,
      "pending": 30,
      "submitted": 70,
      "byUser": {...},
      "byProject": {...}
    }
  }
}
```

### DELETE /api/reannotation/manage-tasks

**功能**：刪除重標註任務

**參數**：
```json
{
  "userId": 1,
  "taskIds": [10, 11, 12]
}
```

**回傳**：
```json
{
  "success": true,
  "deletedCount": 3
}
```

### POST /api/reannotation/manage-tasks

**功能**：手動新增任務（進階功能）

**參數**：
```json
{
  "userId": 1,
  "roundId": 5,
  "sourceDataIds": [100, 101, 102],
  "targetUserIds": [3, 4]
}
```

**回傳**：
```json
{
  "success": true,
  "createdCount": 6
}
```

---

## 📞 常見問題

### Q1: 刪除任務後，標註者已修改的答案會被刪除嗎？

**不會**。刪除任務只會移除 `reannotation_tasks` 表的記錄，不會影響 `annotations` 表的資料。標註者已修改的答案會保留。

### Q2: 可以手動新增任務給特定使用者嗎？

**可以**（需使用 API）。使用 `POST /api/reannotation/manage-tasks` 端點可以手動新增任務。未來版本會新增前端介面。

### Q3: 刪除任務後可以復原嗎？

**不可以**。刪除操作是永久性的，無法復原。建議刪除前先確認。

### Q4: 如何知道哪些任務是誤建的？

可以透過以下方式判斷：
- 查看輪次編號
- 查看分配時間
- 查看任務組別
- 使用篩選器精確定位

### Q5: 刪除任務會影響一致性計算嗎？

**不會**。一致性計算是基於 `annotations` 表的資料，刪除 `reannotation_tasks` 不會影響。

---

## 💡 進階技巧

### 技巧 1: 快速清理特定輪次

```
1. 篩選器選擇專案 → 選擇 Round X
2. 全選 → 刪除
```

### 技巧 2: 只保留特定使用者的任務

```
1. 記下要保留的使用者名單
2. 逐一選擇「不需要的使用者」
3. 全選 → 刪除
4. 重複直到只剩下需要的使用者
```

### 技巧 3: 批次處理多個輪次

```
1. 使用搜尋框搜尋專案名稱
2. 查看所有相關任務
3. 手動勾選需要刪除的任務
4. 批次刪除
```

---

## 🎓 總結

重標註任務管理功能讓你可以：

✅ **彈性控制** - 自由刪除不需要的任務
✅ **精確篩選** - 快速找到特定任務
✅ **批次操作** - 提升管理效率
✅ **保留歷史** - 審計日誌不受影響

記得謹慎使用刪除功能，因為操作無法復原！ 🔥
