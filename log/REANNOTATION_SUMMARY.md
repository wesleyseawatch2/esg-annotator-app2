# ğŸ”„ é‡æ¨™è¨»åŠŸèƒ½å¯¦ä½œæ‘˜è¦

## âœ… å·²å®Œæˆé …ç›®

### 1. è³‡æ–™åº«è¨­è¨ˆ (Database Schema)

**æª”æ¡ˆ**: `scripts/add-reannotation-feature.sql`, `scripts/migrate-add-reannotation.js`

å»ºç«‹çš„è³‡æ–™è¡¨ï¼š
- âœ… `reannotation_rounds` - é‡æ¨™è¨»è¼ªæ¬¡ç®¡ç†
- âœ… `reannotation_tasks` - ä»»å‹™åˆ†é…è¨˜éŒ„
- âœ… `agreement_scores_cache` - ä¸€è‡´æ€§åˆ†æ•¸å¿«å–
- âœ… `reannotation_audit_log` - å¯©è¨ˆæ—¥èªŒ
- âœ… `annotations` è¡¨æ–°å¢æ¬„ä½ï¼š
  - `reannotation_round` - è¼ªæ¬¡ç·¨è™Ÿ
  - `version` - ç‰ˆæœ¬è™Ÿ
  - `last_agreement_score` - æœ€å¾Œåˆ†æ•¸ (JSONB)
  - `persist_answer` - æ˜¯å¦å …æŒç­”æ¡ˆ
  - `reannotation_comment` - å‚™è¨»

åŸ·è¡Œé·ç§»ï¼š
```bash
npm run migrate:reannotation
```

---

### 2. å¾Œç«¯ API (Backend APIs)

#### API 1: GET /api/reannotation/queue
**æª”æ¡ˆ**: `app/api/reannotation/queue/route.js`

**åŠŸèƒ½**: å–å¾—ä½¿ç”¨è€…çš„é‡æ¨™è¨»ä»»å‹™æ¸…å–®

**åƒæ•¸**:
- `userId` (å¿…å¡«)
- `projectId` (é¸å¡«)
- `taskGroup` (é¸å¡«)

**å›å‚³**: ä»»å‹™æ¸…å–®ã€æ¨™è¨»æŒ‡å¼•ã€çµ±è¨ˆè³‡è¨Š

#### API 2: POST /api/reannotation/submit
**æª”æ¡ˆ**: `app/api/reannotation/submit/route.js`

**åŠŸèƒ½**: é€å‡ºé‡æ¨™è¨»çµæœ

**åƒæ•¸**:
- `taskId` - ä»»å‹™ ID
- `userId` - ä½¿ç”¨è€… ID
- `sourceDataId` - è³‡æ–™ ID
- `answers` - æ–°çš„æ¨™è¨»ç­”æ¡ˆ
- `persistAnswer` - æ˜¯å¦å …æŒç­”æ¡ˆ
- `comment` - å‚™è¨»

**åŠŸèƒ½ç´°ç¯€**:
- âœ… è¨˜éŒ„å¯©è¨ˆæ—¥èªŒ
- âœ… æ›´æ–°æ¨™è¨»ç‰ˆæœ¬è™Ÿ
- âœ… æ¸…é™¤ä¸€è‡´æ€§åˆ†æ•¸å¿«å–
- âœ… æ›´æ–°ä»»å‹™ç‹€æ…‹

#### API 3: POST /api/reannotation/create-round
**æª”æ¡ˆ**: `app/api/reannotation/create-round/route.js`

**åŠŸèƒ½**: è¨ˆç®—ä¸€è‡´æ€§ä¸¦å»ºç«‹é‡æ¨™è¨»è¼ªæ¬¡ï¼ˆç®¡ç†å“¡å°ˆç”¨ï¼‰

**åƒæ•¸**:
- `userId` - ç®¡ç†å“¡ ID
- `projectId` - å°ˆæ¡ˆ ID
- `taskGroup` - ä»»å‹™çµ„åˆ¥ (group1/group2)
- `threshold` - ä¸€è‡´æ€§é–€æª» (é è¨­ 0.5)
- `assignAll` - æ˜¯å¦åˆ†é…çµ¦æ‰€æœ‰äºº

**åŠŸèƒ½ç´°ç¯€**:
- âœ… è¨ˆç®— Local Krippendorff's Alpha
- âœ… æ‰¾å‡ºåˆ†æ•¸ < é–€æª»çš„è³‡æ–™
- âœ… è‡ªå‹•å»ºç«‹è¼ªæ¬¡è¨˜éŒ„
- âœ… ç‚ºæ¯ä½æ¨™è¨»è€…å»ºç«‹ä»»å‹™
- âœ… å¿«å–ä¸€è‡´æ€§åˆ†æ•¸

---

### 3. å‰ç«¯é é¢ (Frontend Pages)

#### é é¢ 1: /reannotation (æ¨™è¨»è€…)
**æª”æ¡ˆ**: `app/reannotation/page.js`

**åŠŸèƒ½**: é‡æ¨™è¨»ä»»å‹™åˆ—è¡¨é 

**é¡¯ç¤ºå…§å®¹**:
- âœ… çµ±è¨ˆæ‘˜è¦ (ç¸½ä»»å‹™æ•¸ã€å¾…è™•ç†ã€å·²å®Œæˆ)
- âœ… æŒ‰å°ˆæ¡ˆå’Œä»»å‹™çµ„åˆ†çµ„é¡¯ç¤º
- âœ… æ¯ç­†ä»»å‹™é¡¯ç¤ºï¼š
  - è³‡æ–™ IDã€é ç¢¼
  - æ–‡æœ¬æ‘˜è¦
  - æ¨™è¨˜çš„ä»»å‹™åŠåˆ†æ•¸
  - ç‹€æ…‹å¾½ç« 
- âœ… ã€Œé–‹å§‹ä¿®æ”¹ã€æŒ‰éˆ•

#### é é¢ 2: /reannotation/[taskId] (æ¨™è¨»è€…)
**æª”æ¡ˆ**: `app/reannotation/[taskId]/page.js`

**åŠŸèƒ½**: é‡æ¨™è¨»è©³ç´°é é¢

**å·¦å´**:
- âœ… PDF é è¦½
- âœ… åŸå§‹æ–‡æœ¬é¡¯ç¤º

**å³å´**:
- âœ… è­¦å‘Šé¢æ¿ï¼ˆé¡¯ç¤ºéœ€é‡æ–°æª¢è¦–çš„é …ç›®åŠåˆ†æ•¸ï¼‰
- âœ… æ¨™è¨»æŒ‡å¼•ï¼ˆæŒ‰ä»»å‹™çµ„åˆ¥é¡¯ç¤ºï¼‰
- âœ… æ¨™è¨»è¡¨å–®ï¼ˆåªé¡¯ç¤ºéœ€é‡æ–°æª¢è¦–çš„æ¬„ä½ï¼‰
- âœ… ã€Œæˆ‘ä»å …æŒæˆ‘çš„åŸå§‹ç­”æ¡ˆã€å‹¾é¸æ¡†
- âœ… å‚™è¨»æ¬„ä½
- âœ… é€å‡ºæŒ‰éˆ•

#### é é¢ 3: /admin/reannotation (ç®¡ç†å“¡)
**æª”æ¡ˆ**: `app/admin/reannotation/page.js`

**åŠŸèƒ½**: é‡æ¨™è¨»ç®¡ç†é é¢

**åŠŸèƒ½**:
- âœ… é¸æ“‡å·²å®Œæˆæ¨™è¨»çš„å°ˆæ¡ˆ
- âœ… é¸æ“‡ä»»å‹™çµ„åˆ¥ (Group 1 æˆ– Group 2)
- âœ… è¨­å®šä¸€è‡´æ€§é–€æª»
- âœ… å»ºç«‹æ–°è¼ªæ¬¡
- âœ… åŠŸèƒ½èªªæ˜èˆ‡ä½¿ç”¨æç¤º

---

### 4. å‰ç«¯æ•´åˆ (Frontend Integration)

#### ä½¿ç”¨è€…ä¸»é æç¤º
**æª”æ¡ˆ**: `app/page.js` (ä¿®æ”¹)

**æ–°å¢åŠŸèƒ½**:
- âœ… è¼‰å…¥é‡æ¨™è¨»ä»»å‹™æ•¸é‡
- âœ… é¡¯ç¤ºå¾…è™•ç†ä»»å‹™æç¤ºå¡ç‰‡
- âœ… æä¾›å‰å¾€è™•ç†ä»»å‹™çš„æŒ‰éˆ•

#### Admin å¾Œå°å…¥å£
**æª”æ¡ˆ**: `app/admin/page.js` (ä¿®æ”¹)

**æ–°å¢åŠŸèƒ½**:
- âœ… åœ¨å°èˆªå€æ–°å¢ã€ŒğŸ”„ é‡æ¨™è¨»ç®¡ç†ã€æŒ‰éˆ•
- âœ… è·³è½‰è‡³ `/admin/reannotation`

---

### 5. æ–‡ä»¶èˆ‡è¨­å®š (Documentation & Configuration)

#### ä½¿ç”¨æŒ‡å—
**æª”æ¡ˆ**: `docs/reannotation-guide.md`

**å…§å®¹**:
- âœ… åŠŸèƒ½æ¦‚è¿°
- âœ… ä»»å‹™åˆ†çµ„ç­–ç•¥
- âœ… ç®¡ç†å“¡ä½¿ç”¨æµç¨‹
- âœ… æ¨™è¨»è€…ä½¿ç”¨æµç¨‹
- âœ… è³‡æ–™çµæ§‹èªªæ˜
- âœ… API ç«¯é»èªªæ˜
- âœ… å¸¸è¦‹å•é¡Œ FAQ
- âœ… æŠ€è¡“ç´°ç¯€
- âœ… æœ€ä½³å¯¦è¸

#### README æ›´æ–°
**æª”æ¡ˆ**: `README.md` (ä¿®æ”¹)

**æ–°å¢å…§å®¹**:
- âœ… ä¸»è¦åŠŸèƒ½åˆ—è¡¨æ–°å¢é‡æ¨™è¨»åŠŸèƒ½
- âœ… è³‡æ–™åº«é·ç§»æ­¥é©Ÿ
- âœ… é‡æ¨™è¨»åŠŸèƒ½äº®é»å€å¡Š
- âœ… åƒè€ƒæ–‡ä»¶é€£çµ

#### Package.json æ›´æ–°
**æª”æ¡ˆ**: `package.json` (ä¿®æ”¹)

**æ–°å¢è…³æœ¬**:
```json
"migrate:reannotation": "node scripts/migrate-add-reannotation.js"
```

---

## ğŸ¯ æ ¸å¿ƒè¨­è¨ˆåŸå‰‡

### æ–¹æ¡ˆ A: é¡¯ç¤ºçµ±è¨ˆè³‡è¨Š + æŒ‡å¼•ï¼ˆä¸é¡¯ç¤ºä»–äººç­”æ¡ˆï¼‰

1. **ä¸é¡¯ç¤ºä»–äººé€ç­†ç­”æ¡ˆ** âœ…
   - æ¨™è¨»è€…åªèƒ½çœ‹åˆ°ä¸€è‡´æ€§åˆ†æ•¸å’Œçµ±è¨ˆè³‡è¨Š
   - é¿å…äº’ç›¸æŠ„ç­”æ¡ˆçš„å•é¡Œ

2. **ä»»å‹™åˆ†çµ„ç­–ç•¥** âœ…
   - Group 1: promise_status + verification_timeline
   - Group 2: evidence_status + evidence_quality
   - é¿å…ä¸€æ¬¡è™•ç†å¤ªå¤šé …ç›®é€ æˆæ··äº‚

3. **ç‰ˆæœ¬æ§åˆ¶** âœ…
   - æ¯æ¬¡ä¿®æ”¹éƒ½éå¢ç‰ˆæœ¬è™Ÿ
   - é¿å…ã€Œæ¨™è¨˜éæœŸã€å•é¡Œ
   - å¯è¿½æº¯æ‰€æœ‰è®Šæ›´æ­·ç¨‹

4. **å¯©è¨ˆæ—¥èªŒ** âœ…
   - è¨˜éŒ„æ‰€æœ‰ä¿®æ”¹ï¼ˆold_value â†’ new_valueï¼‰
   - è¨˜éŒ„ä¿®æ”¹åŸå› å’Œæ™‚é–“
   - æ”¯æ´å¾ŒçºŒåˆ†æå’Œçˆ­è­°è™•ç†

5. **å …æŒç­”æ¡ˆæ©Ÿåˆ¶** âœ…
   - å…è¨±æ¨™è¨»è€…å‹¾é¸ã€Œæˆ‘ä»å …æŒæˆ‘çš„åŸå§‹ç­”æ¡ˆã€
   - æ¨™è¨˜ç‚º `persist_answer = TRUE`
   - ç®¡ç†å“¡å¯é€éå¯©è¨ˆæ—¥èªŒæŸ¥çœ‹ç†ç”±

---

## ğŸ“Š æŠ€è¡“æ¶æ§‹

### å‰ç«¯æŠ€è¡“
- **Framework**: Next.js 15 (App Router)
- **UI**: React 19
- **æ¨£å¼**: Inline Styles (èˆ‡ç¾æœ‰ç³»çµ±ä¸€è‡´)
- **è·¯ç”±**: Dynamic Routes `/reannotation/[taskId]`

### å¾Œç«¯æŠ€è¡“
- **API**: Next.js API Routes
- **è³‡æ–™åº«**: Vercel Postgres (SQL)
- **è¨ˆç®—**: Krippendorff's Alpha (JavaScript implementation)

### è³‡æ–™æµç¨‹
```
ç®¡ç†å“¡å»ºç«‹è¼ªæ¬¡
  â†“
è¨ˆç®— Local Alpha â†’ æ‰¾å‡º score < threshold çš„è³‡æ–™
  â†“
å»ºç«‹ reannotation_rounds å’Œ reannotation_tasks
  â†“
æ¨™è¨»è€…ç™»å…¥ â†’ çœ‹åˆ°ä»»å‹™æç¤º
  â†“
é€²å…¥ /reannotation â†’ é¸æ“‡ä»»å‹™
  â†“
é€²å…¥ /reannotation/[taskId] â†’ æŸ¥çœ‹æŒ‡å¼•ã€ä¿®æ”¹ç­”æ¡ˆ
  â†“
é€å‡º â†’ è¨˜éŒ„å¯©è¨ˆæ—¥èªŒ â†’ æ›´æ–°ç‰ˆæœ¬è™Ÿ â†’ æ¸…é™¤å¿«å–
  â†“
ç®¡ç†å“¡å¯é‡æ–°è¨ˆç®— â†’ å»ºç«‹æ–°è¼ªæ¬¡ (Round 2, 3...)
```

---

## ğŸ”§ ä½¿ç”¨æ­¥é©Ÿæ‘˜è¦

### ç®¡ç†å“¡
```bash
# 1. åŸ·è¡Œè³‡æ–™åº«é·ç§»
npm run migrate:reannotation

# 2. å‰å¾€ç®¡ç†å¾Œå°
ç€è¦½å™¨é–‹å•Ÿ: /admin

# 3. é»æ“Šã€ŒğŸ”„ é‡æ¨™è¨»ç®¡ç†ã€
# 4. é¸æ“‡å°ˆæ¡ˆã€ä»»å‹™çµ„åˆ¥ã€è¨­å®šé–€æª»
# 5. é»æ“Šã€Œå»ºç«‹é‡æ¨™è¨»è¼ªæ¬¡ã€
```

### æ¨™è¨»è€…
```bash
# 1. ç™»å…¥ç³»çµ±
# 2. çœ‹åˆ°ã€Œä½ æœ‰ X å€‹é‡æ¨™è¨»ä»»å‹™å¾…è™•ç†ã€
# 3. é»æ“Šã€Œå‰å¾€è™•ç†é‡æ¨™è¨»ä»»å‹™ã€
# 4. é¸æ“‡ä»»å‹™ â†’ æŸ¥çœ‹æŒ‡å¼• â†’ ä¿®æ”¹ç­”æ¡ˆ
# 5. å‹¾é¸ã€Œå …æŒç­”æ¡ˆã€ï¼ˆé¸å¡«ï¼‰â†’ å¡«å¯«å‚™è¨»ï¼ˆé¸å¡«ï¼‰
# 6. é»æ“Šã€Œé€å‡ºé‡æ¨™è¨»ã€
```

---

## ğŸ“ æª”æ¡ˆæ¸…å–®

### æ–°å¢æª”æ¡ˆ
```
scripts/
â”œâ”€â”€ add-reannotation-feature.sql          # SQL é·ç§»è…³æœ¬
â””â”€â”€ migrate-add-reannotation.js           # JS é·ç§»è…³æœ¬

app/api/reannotation/
â”œâ”€â”€ queue/route.js                        # å–å¾—ä»»å‹™æ¸…å–® API
â”œâ”€â”€ submit/route.js                       # é€å‡ºé‡æ¨™è¨» API
â””â”€â”€ create-round/route.js                 # å»ºç«‹è¼ªæ¬¡ API

app/reannotation/
â”œâ”€â”€ page.js                               # ä»»å‹™åˆ—è¡¨é 
â””â”€â”€ [taskId]/page.js                      # ä»»å‹™è©³ç´°é 

app/admin/reannotation/
â””â”€â”€ page.js                               # ç®¡ç†é é¢

docs/
â”œâ”€â”€ reannotation-guide.md                 # å®Œæ•´ä½¿ç”¨æŒ‡å—
â””â”€â”€ REANNOTATION_SUMMARY.md               # å¯¦ä½œæ‘˜è¦ï¼ˆæœ¬æ–‡ä»¶ï¼‰
```

### ä¿®æ”¹æª”æ¡ˆ
```
package.json                              # æ–°å¢é·ç§»è…³æœ¬
README.md                                 # æ–°å¢åŠŸèƒ½èªªæ˜
app/page.js                               # æ–°å¢ä»»å‹™æç¤º
app/admin/page.js                         # æ–°å¢ç®¡ç†å…¥å£
```

---

## âœ¨ ç‰¹è‰²åŠŸèƒ½

1. **é›¶å¹²æ“¾è¨­è¨ˆ** - æ¨™è¨»è€…ç„¡æ³•çœ‹åˆ°ä»–äººç­”æ¡ˆï¼Œæ¸›å°‘äº’ç›¸å½±éŸ¿
2. **æ™ºèƒ½åˆ†çµ„** - é¿å…ä¸€æ¬¡è™•ç†å¤ªå¤šé …ç›®ï¼Œé™ä½èªçŸ¥è² è·
3. **ç‰ˆæœ¬è¿½è¹¤** - å®Œæ•´è¨˜éŒ„ä¿®æ”¹æ­·ç¨‹ï¼Œå¯è¿½æº¯æ¯æ¬¡è®Šæ›´
4. **å …æŒæ©Ÿåˆ¶** - å…è¨±æ¨™è¨»è€…å …æŒåˆ¤æ–·ï¼Œé¿å…ç›²ç›®ä¿®æ”¹
5. **å³æ™‚é€šçŸ¥** - ä¸»é è‡ªå‹•é¡¯ç¤ºå¾…è™•ç†ä»»å‹™ï¼Œç„¡éœ€æ‰‹å‹•æŸ¥è©¢
6. **çµ±è¨ˆè¦–è¦ºåŒ–** - æ¸…æ¥šé¡¯ç¤ºä¸€è‡´æ€§åˆ†æ•¸ï¼Œå”åŠ©åˆ¤æ–·åš´é‡ç¨‹åº¦
7. **å¯©è¨ˆæ—¥èªŒ** - å®Œæ•´è¿½è¹¤æ‰€æœ‰è®Šæ›´ï¼Œæ”¯æ´å¾ŒçºŒåˆ†æ

---

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè­°

### å¯é¸å¢å¼·åŠŸèƒ½
1. **é€šçŸ¥ç³»çµ±æ•´åˆ** - å»ºç«‹è¼ªæ¬¡æ™‚ç™¼é€ Email é€šçŸ¥
2. **æ‰¹æ¬¡åŒ¯å‡º** - åŒ¯å‡ºé‡æ¨™è¨»æ­·ç¨‹ç‚º CSV
3. **ä¸€è‡´æ€§è¶¨å‹¢åœ–** - è¦–è¦ºåŒ–é¡¯ç¤ºæ¯è¼ªçš„ä¸€è‡´æ€§è®ŠåŒ–
4. **å°‘æ•¸æ´¾åˆ†é…ç­–ç•¥** - åªè®“å°‘æ•¸æ´¾é‡æ¨™è¨»ï¼ˆ2:1 ç­–ç•¥ï¼‰
5. **Adjudicator æ¨¡å¼** - æŒ‡å®šå°ˆå®¶ä»²è£æŒçºŒä¸ä¸€è‡´çš„æ¡ˆä¾‹
6. **Mobile å„ªåŒ–** - RWD éŸ¿æ‡‰å¼è¨­è¨ˆå„ªåŒ–

### æ¸¬è©¦æ¸…å–®
- [ ] è³‡æ–™åº«é·ç§»æ¸¬è©¦
- [ ] API ç«¯é»æ¸¬è©¦
- [ ] å‰ç«¯é é¢æ¸¬è©¦
- [ ] å®Œæ•´æµç¨‹æ¸¬è©¦ï¼ˆç®¡ç†å“¡å»ºç«‹ â†’ æ¨™è¨»è€…è™•ç†ï¼‰
- [ ] å¤šè¼ªé‡æ¨™è¨»æ¸¬è©¦
- [ ] å¯©è¨ˆæ—¥èªŒé©—è­‰
- [ ] ç‰ˆæœ¬è™Ÿéå¢æ¸¬è©¦
- [ ] å¿«å–æ¸…é™¤æ¸¬è©¦

---

## ğŸ“ æ”¯æ´èˆ‡ç¶­è­·

- **æ–‡ä»¶**: `docs/reannotation-guide.md`
- **è³‡æ–™åº«**: Vercel Postgres
- **éƒ¨ç½²**: Vercel
- **ç›£æ§**: å¯é€éå¯©è¨ˆæ—¥èªŒè¿½è¹¤ä½¿ç”¨æƒ…æ³

---

**å¯¦ä½œå®Œæˆæ—¥æœŸ**: 2025-12-13
**å¯¦ä½œæ–¹æ¡ˆ**: æ–¹æ¡ˆ A (é¡¯ç¤ºçµ±è¨ˆè³‡è¨Š + æŒ‡å¼•æ‘˜è¦)
**ç‹€æ…‹**: âœ… å·²å®Œæˆï¼Œå¯ç«‹å³ä½¿ç”¨
